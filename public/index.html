<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Parkour Collab</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
      :root {
        /* Canvas sizing */
        --canvas-width: 750px;
        --canvas-height: 500px;

        /* Layout spacing */
        --panel-gap: 1rem;

        /* Font sizes */
        --left-panel-font-size: 13px;
        --home-font-size: 16px;

        /* Color tokens */
        --bg: #121212;
        --panel-bg: #1f1f1f;
        --card-bg: #222;
        --muted-border: #333;
        --accent: #d2691e;
      }

      /* Reset */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html,
      body {
        height: 100%;
      }

      body {
        font-family: "Lexend", sans-serif;
        background: var(--bg);
        color: #eee;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
      }

      /* HOME SCREEN */
      #homeScreen {
        width: 800px;
        display: flex;
        gap: 2rem;
        background: var(--panel-bg);
        padding: 2rem;
        border-radius: 10px;
        font-size: var(--home-font-size);
      }

      .column {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .box {
        background: var(--card-bg);
        padding: 1rem;
        border-radius: 8px;
        border: 1px solid var(--muted-border);
      }

      .info-box p,
      .info-box ol,
      .info-box ul {
        margin-bottom: 0.8rem;
        line-height: 1.4;
      }

      .controls-box input[type="text"] {
        margin-top: 1rem;
        padding: 0.5rem;
        border-radius: 4px;
        border: 1px solid #444;
        background: #1e1e1e;
        color: #eee;
        width: 100%;
        font-size: 14px;
        font-family: "Lexend", sans-serif;
      }

      .controls-box button {
        padding: 0.6rem 1.2rem;
        background: #333;
        color: #eee;
        border: none;
        border-radius: 5px;
        font-weight: 600;
        margin-top: 0.6rem;
        font-size: 14px;
        cursor: pointer;
        font-family: "Lexend", sans-serif;
      }

      .inline-check {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-top: 0.8rem;
      }

      #readyList {
        list-style: none;
        max-height: 200px;
        overflow-y: auto;
        padding-left: 0.4rem;
      }

      #readyList li {
        display: grid;
        grid-template-columns: 1fr 100px;
        border-bottom: 1px solid var(--muted-border);
        padding: 0.4rem 0;
      }

      /* CANVAS WRAPPER */
      #canvasWrapper {
        display: none;
        width: 100vw;
        height: 100vh;
        justify-content: center;
        align-items: flex-start;
        padding: 1rem;
        box-sizing: border-box;
      }

      .main-panel {
        display: flex;
        gap: var(--panel-gap);
        align-items: flex-start;
      }

      /* LEFT SIDEBAR */
      .sidebar {
        width: 240px;
        height: calc(var(--canvas-height) + 100px);
        background: var(--panel-bg);
        padding: 1rem;
        border-right: 1px solid var(--muted-border);
        display: flex;
        flex-direction: column;
        gap: 0.8rem;
        font-size: var(--left-panel-font-size);
      }

      .sidebar .box h3 {
        margin-bottom: 0.6rem;
        color: #aaa;
        font-size: 1rem;
      }

      .sidebar .box:last-child {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-height: 0;
      }

      .two-col-list {
        list-style: none;
        height: calc(var(--canvas-height) * 0.3);
        max-height: calc(var(--canvas-height) * 0.3);
        overflow-y: auto;
        padding-left: 0;
      }

      .two-col-list li {
        border-bottom: 1px solid var(--muted-border);
        padding-bottom: 4px;
        margin-bottom: 2px;
      }

      .two-col-list li:last-child {
        border-bottom: none;
        margin-bottom: 0;
      }

      .player-slot {
        display: grid;
        grid-template-columns: 1fr auto;
        align-items: center;
        padding: 0.45rem;
        border-bottom: 1px solid var(--muted-border);
        min-height: 36px;
      }

      .player-slot .status {
        color: #aaa;
        font-weight: 400;
      }

      .player-slot.ready .status {
        color: #00e676;
        font-weight: 700;
      }

      .player-slot:last-child {
        border-bottom: none;
      }

      /* VOTES GRID */
      .votes-grid {
        display: grid;
        grid-template-columns: 1fr 44px;
        row-gap: 6px;
        column-gap: 8px;
        align-items: center;
        font-size: inherit;
      }

      .votes-grid label,
      .votes-grid #voteStatus {
        font-size: 1em;
      }

      .votes-grid input[type="checkbox"] {
        justify-self: center;
        align-self: center;
        transform: scale(0.98);
      }

      .copy-map-row {
        margin-top: 8px;
      }

      #copyMapBtn {
        padding: 0.45rem 0.85rem;
        font-family: "Lexend", sans-serif;
        font-size: 13px;
        width: fit-content;
      }

      /* CANVAS AREA */
      .canvas-area {
        display: flex;
        justify-content: center;
        align-items: flex-start;
      }

      .canvas-frame {
        width: var(--canvas-width);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 12px;
      }

      canvas {
        width: 100%;
        height: auto;
        background: #1e1e1e;
        border: 2px solid #444;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        display: block;
      }

      /* CONTROL BOX */
      .control-box {
        background: var(--card-bg);
        padding: 0.9rem;
        border-radius: 8px;
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.6rem;
        border: 1px solid var(--muted-border);
      }

      .control-box #status {
        font-size: 13px;
      }

      /* BUTTONS & INPUTS */
      button {
        font-family: "Lexend", sans-serif;
        font-size: 13px;
        padding: 0.45rem 0.9rem;
        background: #333;
        color: #eee;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      button:hover {
        background: #444;
      }

      #deleteLineBtn {
        width: fit-content;
      }

      select,
      input,
      textarea {
        font-family: "Lexend", sans-serif;
      }

      #lineTypeSelect {
        padding: 0.45rem;
        background: #333;
        color: #eee;
        border: none;
        border-radius: 5px;
        font-size: 13px;
      }

      #lineTypeSelect:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      /* CHAT */
      .chat-box {
        width: 260px;
        background: var(--panel-bg);
        padding: 1rem;
        border-left: 1px solid var(--muted-border);
        display: flex;
        flex-direction: column;
        gap: 0.6rem;
      }

      .chat-box h3 {
        margin: 0;
        font-size: 1rem;
        color: #ddd;
      }

      #chatMessages {
        background: var(--card-bg);
        padding: 0.6rem;
        border-radius: 6px;
        overflow-y: auto;
        height: calc(var(--canvas-height) - 40px);
        border: 1px solid var(--muted-border);
        font-size: 13px;
      }

      #chatMessages > * {
        border-bottom: 1px solid var(--muted-border);
        padding-bottom: 4px;
        margin-bottom: 4px;
      }

      #chatMessages > *:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
      }

      #chatMessages::-webkit-scrollbar {
        width: 7px;
      }

      #chatMessages::-webkit-scrollbar-thumb {
        background: #444;
        border-radius: 4px;
      }

      #chatMessages p {
        margin: 0.25rem 0;
        word-wrap: break-word;
      }

      #chatInput {
        padding: 0.45rem;
        border-radius: 4px;
        border: 1px solid #444;
        background: #1e1e1e;
        color: #eee;
        font-size: 13px;
      }

      #chatSendBtn {
        padding: 0.45rem 0.8rem;
        font-size: 13px;
        width: fit-content;
        align-self: flex-end;
      }

      /* TIPS LIST */
      .tips-list {
        flex: 1;
        font-size: inherit;
        line-height: 1.5;
        padding-left: 1.2rem;
        max-height: calc(var(--canvas-height) * 0.45);
        overflow-y: auto;
        min-height: 0;
      }

      .tips-list ul {
        padding-left: 1.1rem;
      }

      .tips-list::-webkit-scrollbar,
      .two-col-list::-webkit-scrollbar {
        width: 7px;
      }

      .tips-list::-webkit-scrollbar-thumb,
      .two-col-list::-webkit-scrollbar-thumb {
        background: #444;
        border-radius: 4px;
      }

      .tips-list {
        scrollbar-width: thin;
        scrollbar-color: #444 transparent;
      }

      .two-col-list {
        scrollbar-width: thin;
        scrollbar-color: #444 transparent;
      }

      /* POPUP */
      .popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.85);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 999;
      }

      .popup-box {
        position: relative;
        background: var(--panel-bg);
        padding: 1.5rem;
        border-radius: 10px;
        text-align: center;
        width: 360px;
        border: 1px solid var(--muted-border);
        font-family: "Lexend", sans-serif;
      }

      .popup-box h2 {
        margin-bottom: 0.6rem;
      }

      .popup-box p {
        margin-bottom: 1rem;
        color: #ddd;
      }

      .popup-close {
        position: absolute;
        top: 8px;
        right: 8px;
        background: none;
        color: #fff;
        font-size: 1.1rem;
        border: none;
        cursor: pointer;
      }

      .popup-actions {
        display: flex;
        gap: 8px;
        justify-content: center;
      }

      .popup-actions button {
        padding: 0.5rem 0.9rem;
      }

      /* RESPONSIVE */
      @media (max-width: 1200px) {
        .main-panel {
          flex-direction: column;
          align-items: center;
          gap: 1rem;
        }

        .sidebar,
        .chat-box {
          width: 90%;
          max-width: 340px;
        }

        .canvas-frame {
          width: min(90vw, var(--canvas-width));
        }
      }
    </style>
  </head>

  <body>
    <!-- HOME SCREEN -->
    <div id="homeScreen">
      <div class="column">
        <div class="box info-box">
          <h2>Welcome!</h2>
          <ul style="margin-top: 1.4rem; padding-left: 1.2rem">
            <li style="margin-bottom: 0.4rem">
              This is an app to collaborate on bonk.io parkour maps.
            </li>
            <li style="margin-bottom: 0.4rem">
              Draw lines on a shared canvas.
            </li>
            <li style="margin-bottom: 0.4rem">
              To copy the final map, use the <em>pkrGenerator</em> mod by
              eldertubby.
            </li>
            <li style="margin-bottom: 0.4rem">
              The map data is also compatible with the parkour generator app.
            </li>
            <li style="margin-bottom: 0.4rem">
              All code is available on elder-tubby's GitHub.
            </li>
          </ul>
        </div>
      </div>

      <div class="column">
        <div class="box controls-box">
          <input
            type="text"
            id="usernameInput"
            placeholder="Your username"
            autocomplete="off"
            maxlength="26"
          />
          <button id="joinBtn">Join Lobby</button>

          <div class="inline-check">
            <input type="checkbox" id="readyCheckbox" />
            <label for="readyCheckbox">Ready</label>
          </div>

          <p style="font-size: 14px; margin-top: 1rem">
            Drawing will start when 2 players are ready.
          </p>

          <p
            id="lobbyMessage"
            style="
              color: var(--accent);
              font-size: 14px;
              margin-top: 0.5rem;
              display: none;
            "
          >
            A game is already in progress. Please wait for the next round.
          </p>
        </div>

        <div class="box">
          <h3>Lobby Players</h3>
          <ul id="readyList"></ul>
        </div>
      </div>
    </div>

    <!-- DRAWING AREA -->
    <div id="canvasWrapper">
      <div class="main-panel">
        <!-- LEFT SIDEBAR -->
        <div class="sidebar">
          <div class="box">
            <h3>Players</h3>
            <ul class="two-col-list" id="playerList"></ul>
          </div>

          <div class="box">
            <div class="votes-grid">
              <label for="voteCheckbox">Vote to finish</label>
              <input type="checkbox" id="voteCheckbox" />

              <div id="voteStatus">0 / 0 voted</div>
              <div></div>

              <label for="hideUsernamesCheckbox">Hide names (H)</label>
              <input type="checkbox" id="hideUsernamesCheckbox" />
            </div>

            <div class="copy-map-row">
              <button id="copyMapBtn">Copy Map Data (C)</button>
            </div>
          </div>

          <div class="box">
            <h3>Hotkeys</h3>
            <ul class="tips-list">
              <li><strong>B</strong> – Bouncy</li>
              <li><strong>D</strong> – Death</li>
              <li><strong>N</strong> – Non-bouncy</li>
              <li><strong>X</strong> – Delete</li>
              <li><strong>CTRL Z</strong> – Delete last line</li>
            </ul>
          </div>
        </div>

        <!-- CANVAS -->
        <div class="canvas-area">
          <div class="canvas-frame">
            <canvas id="canvas" width="750" height="500"></canvas>

            <div class="control-box">
              <div id="status">Draw your line...</div>

              <div style="display: flex; gap: 12px; align-items: center">
                <button id="deleteLineBtn" disabled>Delete Line</button>
                <select id="lineTypeSelect" disabled>
                  <option value="none">None</option>
                  <option value="bouncy">Bouncy</option>
                  <option value="death">Death</option>
                </select>
              </div>
              <!-- Spawn Size Slider -->
              <div style="display: flex; gap: 8px; align-items: center">
                <label for="spawnSizeSlider" style="white-space: nowrap"
                  >Spawn Size:</label
                >
                <input
                  type="range"
                  id="spawnSizeSlider"
                  min="1"
                  max="13"
                  value="9"
                />
                <span id="spawnSizeValue">9</span>
              </div>
            </div>
          </div>
        </div>

        <!-- CHAT -->
        <div class="chat-box">
          <h3>Chat</h3>
          <div id="chatMessages"></div>
          <input
            type="text"
            id="chatInput"
            placeholder="Press Enter to focus chat"
            autocomplete="off"
          />
          <button id="chatSendBtn">Send</button>
        </div>
      </div>
    </div>

    <!-- GAME END POPUP -->
    <div id="gameEndPopup" class="popup-overlay" aria-hidden="true">
      <div class="popup-box">
        <button id="popup-close" class="popup-close" aria-label="Close">
          ×
        </button>
        <h2>Game ended</h2>
        <p>Would you like to copy map data?</p>
        <div class="popup-actions">
          <button id="copyLineInfoBtn">Copy map data (C)</button>
        </div>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script type="module" src="app.js"></script>
  </body>
</html>
