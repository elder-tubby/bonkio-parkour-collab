<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Parkour Collab</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
  </head>

  <body>
    <div id="homeScreen" class="home-screen">
      <div class="column">
        <div class="box info-box">
          <h2>Welcome!</h2>
          <ul>
            <li>This is an app to collaborate on bonk.io parkour maps.</li>
            <li>Draw lines on a shared canvas.</li>
            <li>
              To copy the final map, use the
              <a
                class="info-link"
                href="https://github.com/elder-tubby/bonkio-parkour-generator/blob/main/browser-script/pkrGenerator.js"
                target="_blank"
              >
                pkrGenerator mod <span>&#x2197;</span>
              </a>
              .
            </li>
            <li>
              The map data is also compatible with the
              <a
                class="info-link"
                href="https://www.youtube.com/playlist?list=PLo8kHyDWLzW3DWnnWw2IHE1C17TSGQWiv"
                target="_blank"
              >
                parkour generator app <span>&#x2197;</span>
              </a>
              .
            </li>
            <li>
              All code is available on elder-tubby's
              <a
                class="info-link"
                href="https://github.com/elder-tubby"
                target="_blank"
              >
                GitHub <span>&#x2197;</span>
              </a>
              .
            </li>
          </ul>
        </div>
      </div>

      <div class="column">
        <div class="box controls-box">
          <input
            type="text"
            id="usernameInput"
            placeholder="Your username"
            autocomplete="off"
            maxlength="26"
          />
          <button id="joinBtn" class="btn">Set Name</button>
          <div class="inline-check">
            <input type="checkbox" id="readyCheckbox" />
            <label for="readyCheckbox">Ready</label>
          </div>
          <p id="lobbyMessage" class="lobby-message">
            Drawing will start when 2 players are ready.
          </p>
        </div>

        <div class="box">
          <h3>Lobby Players</h3>
          <ul id="readyList" class="lobby-list"></ul>
        </div>
      </div>
    </div>

    <div id="canvasWrapper" class="hidden">
      <div class="main-panel">
        <div class="sidebar">
          <div class="box">
            <h3>Players</h3>
            <ul class="player-list" id="playerList"></ul>
          </div>
          <div class="box">
            <div class="votes-grid">
              <label for="voteCheckbox">Vote to finish</label>
              <input type="checkbox" id="voteCheckbox" />
              <div id="voteStatus">0 / 0 voted</div>
              <div></div>
              <label for="hideUsernamesCheckbox">Hide tags (H)</label>
              <input type="checkbox" id="hideUsernamesCheckbox" />
            </div>
            <div class="copy-map-row">
              <button id="copyMapBtn" class="btn btn-small">
                Copy map data
              </button>
            </div>
            <div class="copy-map-row">
              <button id="autoGenerateBtn" class="btn btn-small">
                Auto-generate
              </button>
            </div>
          </div>
          <div class="box">
            <h3>Hotkeys</h3>
            <ul class="tips-list">
              <li>
                <strong>SHIFT + MOUSE</strong>
                <span class="hotkey-desc">â€“ Line selection</span>
              </li>
              <li>
                <strong>M</strong>
                <span class="hotkey-desc">â€“ Toggle polygon/line</span>
              </li>
              <li>
                <strong>B</strong> <span class="hotkey-desc">â€“ Bouncy</span>
              </li>
              <li>
                <strong>D</strong> <span class="hotkey-desc">- Death</span>
              </li>
              <li>
                <strong>N</strong> <span class="hotkey-desc">â€“ Non-bouncy</span>
              </li>
              <li>
                <strong>X</strong> <span class="hotkey-desc">â€“ Delete</span>
              </li>
              <li>
                <strong>Arrow keys</strong>
                <span class="hotkey-desc">â€“ Move line</span>
              </li>
              <li>
                <strong>CTRL Z</strong>
                <span class="hotkey-desc">â€“ Delete last line</span>
              </li>
              <li>
                <strong>CTRL A</strong>
                <span class="hotkey-desc">â€“ Select all</span>
              </li>
              <li>
                <strong>CTRL C</strong>
                <span class="hotkey-desc">â€“ Copy map</span>
              </li>
              <li>
                <strong>CTRL V</strong>
                <span class="hotkey-desc">â€“ Paste map</span>
              </li>
              <li>
                <strong>[ ]</strong>
                <span class="hotkey-desc">â€“ Move to back/front</span>
              </li>
              <li>
                <strong>G</strong>
                <span class="hotkey-desc">â€“ Auto-generate pop-up</span>
              </li>
            </ul>
          </div>
          <div class="box hidden" id="adminPanel">
              </div>
          </div>
        </div>

        <div class="canvas-area">
          <div class="canvas-frame">
            <canvas id="canvas" width="750" height="500"></canvas>
            <div class="control-box"></div>
          </div>
        </div>

        <div class="chat-box">
          <h3>Chat</h3>
          <div id="chatMessages"></div>
          <input
            type="text"
            id="chatInput"
            placeholder="Press Enter to start typing..."
            autocomplete="off"
          />
          <div class="chat-actions">
            <button id="chatSendBtn" class="btn btn-small">Send</button>
            <button
              id="chatAudioBtn"
              class="btn btn-icon"
              title="Toggle chat sound"
            >
              ðŸ”Š
            </button>
          </div>
        </div>
      </div>
    </div>

    <div id="gameEndPopup" class="popup-overlay hidden" aria-hidden="true">
      <div class="popup-box">
        <button id="popup-close" class="popup-close" aria-label="Close">
          Ã—
        </button>
        <h2>Game ended</h2>
        <p>Would you like to copy map data?</p>
        <div class="popup-actions">
          <button id="copyLineInfoBtn" class="btn">Copy map data</button>
        </div>
      </div>
    </div>

    <div
      id="autoGeneratePopup"
      class="popup-overlay hidden"
      aria-hidden="true"
    >
      <div class="popup-box">
        <button id="agpCloseBtn" class="popup-close" aria-label="Close">Ã—</button>
        <h2>Auto-Generate Shapes</h2>
        <p>Adjust values for random generation.</p>

        <form id="agpForm">
          <div class="popup-form-row">
            <label for="agpMaxPolygons" title="Max polygons to generate. (Limit: 200)">
              Max Polygons
            </label>
            <input
              type="number"
              id="agpMaxPolygons"
              min="1"
              max="200"
              value="50"
            />
          </div>

          <div class="popup-form-row">
            <label
              for="agpMinDistance"
              title="Min distance between polygons. (Limit: 100)"
            >
              Min Distance
            </label>
            <input type="number" id="agpMinDistance" min="0" max="200" value="10" />
          </div>

          <div class="popup-form-row">
            <label
              for="agpMaxVertices"
              title="Max vertices per polygon. (Range: 3-20)"
            >
              Max Vertices
            </label>
            <input type="number" id="agpMaxVertices" min="3" max="30" value="12" />
          </div>

          <div class="popup-form-row">
            <label for="agpMinArea" title="Range: 1,000 - 50,000">Min Area</label>
            <input
              type="number"
              id="agpMinArea"
              min="200"
              max="50000"
              step="100"
              value="8000"
            />
          </div>

          <div class="popup-form-row">
            <label for="agpMaxArea" title="Range: 1,000 - 50,000">Max Area</label>
            <input
              type="number"
              id="agpMaxArea"
              min="300"
              max="50000"
              step="100"
              value="30000"
            />
          </div>

          <div class="popup-form-row">
            <label for="agpSkipChance" title="Chance to skip a segment (0.0 - 1.0)">
              Skip Chance
            </label>
            <input
              type="number"
              id="agpSkipChance"
              min="0"
              max="1"
              step="0.1"
              value="0"
            />
          </div>

          <label class="weights-label">Type Weights (Relative Chance)</label>
          <div class="weights-row">
            <div>
              <label for="agpWeightNone">None</label>
              <input type="number" id="agpWeightNone" min="0" value="1" />
            </div>
            <div>
              <label for="agpWeightBouncy">Bouncy</label>
              <input type="number" id="agpWeightBouncy" min="0" value="1" />
            </div>
            <div>
              <label for="agpWeightDeath">Death</label>
              <input type="number" id="agpWeightDeath" min="0" value="1" />
            </div>
          </div>

          <div class="popup-actions" style="margin-top: 1rem;">
            <button id="agpCustomRouteBtn" type="submit" class="btn" name="custom">
              Custom Route
            </button>
            <button id="agpRandomRouteBtn" type="submit" class="btn" name="random">
              Random Route
            </button>
          </div>
        </form>
      </div>
    </div>
    
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/poly-decomp@0.3.0/build/decomp.min.js"></script>
    <script type="module" src="app.js"></script>
  </body>
</html>
